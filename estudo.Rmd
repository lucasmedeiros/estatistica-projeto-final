---
title: "Estudo a partir de dados da embarcação de pessoas no Titanic"
author: "Jadson Luan, Jessé Souza e Lucas Medeiros"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(corrplot)
library(dplyr)
library(tidyr)
library(gghighlight)
library(GGally)
library(grid)
library(gridExtra)
library(broom)
library(stats)
titanic_data  <- 
  na.omit(read.csv("data/train.csv", stringsAsFactors = FALSE)) %>%
  select(-c('Name', 'Ticket','Embarked','Cabin', 'PassengerId'))
```

## Descrição a respeito dos dados

 Para esse estudo, foi utilizado um arquivo contendo dados de 891 tripulantes do navio Titanic, que afundou na madrugado do dia 15 de abril de 1912, logo após ter colidido com um iceberg, onde das 2224 pessoas a bordo do navio, entre tripulantes, operários e  oficiais, somente 710 sobreviveram. Nosso objetivo, então, foi a partir da análise dos dados de 7 das variáveis presentes nesse dataset, identificar se houve influencia de um ou mais fatores na sobrevivência, ou não, do passageiro.


## Descrição das variáveis

* **survived**: se uma pessoa que embarcou no Titanic sobreviveu à tragédia ou não, seguindo o modelo abaixo:
  + "1", caso tenha sobrevivido.
  + "0", caso contrário.

  
* **pclass:** classe socio-econômica do passageiro  
  + "1", caso seja da Classe alta  
  + "2", caso seja da Classe média  
  + "3", caso seja da Classe baixa  

  
* **sex:** sexo do passageiro  
  + "1", caso seja Mulher  
  + "0", caso seja Homem  

  
* **fare:** tarifa paga pelo passageiro para embarcar 

* **sibsp:** número de irmãos/cônjuges do passageiro abordo do Titanic
  + O *dataset* define relações familiares da seguinte forma...  
    + Irmãos = irmão, irmã, meio-irmão, meia-irmã
    + Cônjuge = marido, esposa (amantes e noivos/noivas foram ignorados)
    

* **parch:** número de pais / filhos do passageiro abordo do Titanic
  + O *dataset* define relações familiares da seguinte forma...  
    + Pais = mãe, pai
    + Filhos = filho, filha, neto, neta

## Histograma das variáveis

```{r, echo=FALSE}
gather(titanic_data)%>%
  ggplot(aes(value)) +
    geom_histogram(bins = 10) +
      facet_wrap(~key, scales = 'free_x')
```

## Dispersão das variáveis
```{r, echo=FALSE}
plot(titanic_data$Survived, titanic_data$Pclass, 
     xlab = "Sobreviveu?", 
     ylab = "Classe social",
     pch = 19,
     col="light green")

plot(titanic_data$Survived, titanic_data$Sex, 
     xlab = "Sobreviveu?", 
     ylab = "Sexo",
     pch = 19,
     col="light green")

plot(titanic_data$Survived, titanic_data$Age, 
     xlab = "Sobreviveu?", 
     ylab = "Idade",
     pch = 19,
     col="light green")
lines(lowess(titanic_data$Age))

plot(titanic_data$Survived, titanic_data$SibSp, 
     xlab = "Sobreviveu?", 
     ylab = "Nº de irmãos/cônjuges",
     pch = 19,
     col="light green")
lines(lowess(titanic_data$SibSp))

plot(titanic_data$Survived, titanic_data$Parch, 
     xlab = "Sobreviveu?", 
     ylab = "Nº de pais/filhos",
     pch = 19,
     col="light green")
lines(lowess(titanic_data$Parch))

plot(titanic_data$Survived, titanic_data$Fare, 
     xlab = "Sobreviveu?", 
     ylab = "Tarifa paga",
     pch = 19,
     col="light green")
lines(lowess(titanic_data$Fare))
```

## Análise da correlação geral
```{r, echo=FALSE}
# corrplot(cor(titanic_data), method="pie", tl.col="black", type="lower")
titanic_clean_data <- titanic_data
titanic_clean_data %>%
  ggcorr(palette = "RdBu",
         color = "grey50",
         label = TRUE, hjust = 1,
         label_size = 3, size = 4,
         nbreaks = 5, layout.exp = 7)
```

## Correlações das variáveis selecionadas
```{r}
cor(titanic_data$Survived, titanic_data$Pclass)
cor(titanic_data$Survived, titanic_data$Fare)
cor(titanic_data$Survived, titanic_data$Sex)
```

## Análise das correlações das variáveis selecionadas
```{r, echo=FALSE}
titanic_clean_data <- titanic_data %>% select('Survived', 'Pclass', 'Sex', 'Fare')
titanic_clean_data %>%
  ggcorr(palette = "RdBu",
         color = "grey50",
         label = TRUE, hjust = 1,
         label_size = 3, size = 4,
         nbreaks = 5, layout.exp = 7)
```

## Comportamento dos dados em relação à sobrevivência

```{r, echo=FALSE}
sex_disp <- titanic_data %>% 
    ggplot(aes(x = Sex, y = Survived)) + 
    geom_count() 
pclass_disp <-titanic_data %>% 
    ggplot(aes(x = Pclass, y = Survived)) + 
    geom_count() 
fare_disp <-titanic_data %>% 
    ggplot(aes(x = Fare, y = Survived)) + 
    geom_count() 
grid.arrange(sex_disp, pclass_disp, fare_disp, nrow = 1)
```

## Iniciando um modelo de regressão com todas variáveis
Usando a abordagem *backward* temos um modelo com as três variáveis preditivas selecionadas. 
Iremos definir como nível de significância 5%.

## Modelo de regressão inicial
```{r}
model <- lm(formula = Survived ~ Sex + Fare + Pclass, data = titanic_data)
tidy(model)
```

## Análise ANOVA
```{r}
anova(model)
```
# Teste F
A partir dos dados obtidos pela análise ANOVA, é possível perceber que pelo menos uma das variáveis possui Pr(>F) maior do que O nível de significância, fazendo com que seja rejeitada a hipótese nula de que os coeficientes de todas as variáveis possuem valor nulo, resultando em uma regressão válida.

## Removendo a variável 'fare'
Como a variável 'fare' possui um valor-p (~0,418) maior que o nível de significância (0,05) fixado, tiraremos ela do modelo e prosseguimos.

## Novo modelo de regressão
```{r}
model <- lm(formula = Survived ~ Sex + Pclass, data = titanic_data)
tidy(model)
```

## Calculando o R-quadrado
```{r, echo=FALSE}
rQuadrado <- summary(model)$r.squared
rQuadrado
```
O valor rQuadrado de 0.3683315 significa que apenas 36.83% dos dados, aproximadamente, estão sendo representados por esse modelo, valor que pode ser considerado mediano-baixo.

## Interpretação do Modelo resultante
O modelo resultante pode ser representado como sendo:
 
Y = 0.592 + 0.505 * Sex - 0.166 * Pclass

## Análise dos resíduos
### Teste de homogeniedade

Pelo comportamento da linha vermelha, é possivel perceber a não homogenuidade dos resíduos

```{r}
plot(model, which=3, col=c("black"))
```

### Teste de linearidade

A partir do gráfico abaixo, é possivel analisar que os nossos resíduos se distribuem formando uma reta quase horizontal, o que indica que os nossos dados possuem alguma correlação linear.

```{r}
plot(model, which=1, col=c("black"))
```




### Teste de normalidade

O nosso modelosegue uma distribuiçã normal, uma vez que os dados estão acompanhando razoavelmente a linha vermelha

```{r}
plot(model, which=2, col=c("black"))
```

### Teste De Shapiro-Wilk
``` {r}
shapiro.test(residuals(model))
```

## Conclusão
A partir do modelo obtido, é possivel analisar que caso o dado seja do sexo feminino (Sex = 1), a probabilidade do mesmo de sobreviver é muito maior, o que pode ser afetado com a diminuição da classe em que você estava viajando. Tais dados, mesmo possuindo apenas 36.83% de representatividade dentro da amostra, demonstra bem a situação real que ocorreu no navio, pois uma vez que foi comandada a evacuação, muitos dos oficiais usaram a regra de embarcar primeiro mulheres e crianças. 
