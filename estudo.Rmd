---
title: "Estudo a partir de dados da embarcação de pessoas no Titanic"
author: "Jadson Luan, Jessé Souza e Lucas Medeiros"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(corrplot)
library(dplyr)
library(tidyr)
library(gghighlight)
library(GGally)
library(grid)
library(gridExtra)
library(broom)
titanic_data  <- 
  na.omit(read.csv("data/train.csv", stringsAsFactors = FALSE)) %>%
  select(-c('Name', 'Ticket','Embarked','Cabin', 'PassengerId'))
```

## Descrição a respeito dos dados

 Para esse estudo, foi utilizado um arquivo contendo dados de 891 tripulantes do navio Titanic, que afundou na madrugado do dia 15 de abril de 1912, logo após ter colidido com um iceberg, onde das 2224 pessoas a bordo do navio, entre tripulantes, operários e  oficiais, somente 710 sobreviveram. Nosso objetivo, então, foi a partir da análise dos dados de 7 das variáveis presentes nesse dataset, identificar se houve influencia de um ou mais fatores na sobrevivência, ou não, do passageiro.

## Análise da correlação geral
```{r, echo=FALSE}
# corrplot(cor(titanic_data), method="pie", tl.col="black", type="lower")
titanic_clean_data <- titanic_data
titanic_clean_data %>%
  ggcorr(palette = "RdBu",
         color = "grey50",
         label = TRUE, hjust = 1,
         label_size = 3, size = 4,
         nbreaks = 5, layout.exp = 7)
```

## Sobreviventes da tragédia do Titanic

Utilizaremos a variável **Survived**, que diz se uma pessoa que embarcou no Titanic sobreviveu à tragédia ou não, seguindo o modelo abaixo:

- "1", caso tenha sobrevivido.
- "0", caso contrário.

## Descrição das variáveis preditivas

Escolhemos três variáveis que possuem maior coeficiente de determinação sendo elas:

- **Pclass:** classe socio-econômica do passageiro  
1 = Classe alta  
2 = Classe média  
3 = Classe baixa  

- **Sex:** sexo do passageiro  
1 = Mulher  
0 = Homem  

- **Fare:** tarifa paga pelo passageiro para embarcar 

Em outras palavras, as caracteristicas que possuem maior correlação com a sobrevivência do passageiro
são seu sexo, status socio-econômico e tarifa paga.

## Correlações das variáveis selecionadas
```{r}
cor(titanic_data$Survived, titanic_data$Pclass)
cor(titanic_data$Survived, titanic_data$Fare)
cor(titanic_data$Survived, titanic_data$Sex)
```

## Análise das correlações das variáveis selecionadas
```{r, echo=FALSE}
titanic_clean_data <- titanic_data %>% select('Survived', 'Pclass', 'Sex', 'Fare')
titanic_clean_data %>%
  ggcorr(palette = "RdBu",
         color = "grey50",
         label = TRUE, hjust = 1,
         label_size = 3, size = 4,
         nbreaks = 5, layout.exp = 7)
```

## Comportamento dos dados em relação à sobrevivência

```{r, echo=FALSE}
sex_disp <- titanic_data %>% 
    ggplot(aes(x = Sex, y = Survived)) + 
    geom_count() 
pclass_disp <-titanic_data %>% 
    ggplot(aes(x = Pclass, y = Survived)) + 
    geom_count() 
fare_disp <-titanic_data %>% 
    ggplot(aes(x = Fare, y = Survived)) + 
    geom_count() 
grid.arrange(sex_disp, pclass_disp, fare_disp, nrow = 1)
```

## Coeficientes de determinação das variáveis preditivas
```{r}
rsquared_Pclass <- summary(lm(titanic_data$Survived ~ titanic_data$Pclass))$r.squared
rsquared_Pclass

rsquared_Fare <- summary(lm(titanic_data$Survived ~ titanic_data$Fare))$r.squared
rsquared_Fare

rsquared_Sex <- summary(lm(titanic_data$Survived ~ titanic_data$Sex))$r.squared
rsquared_Sex
```

## Histograma das variáveis

```{r, echo=FALSE}
gather(titanic_data)%>%
  ggplot(aes(value)) +
    geom_histogram(bins = 10) +
      facet_wrap(~key, scales = 'free_x')
```

## Iniciando um modelo de regressão com todas variáveis
Usando a abordagem *backward* temos um modelo com as três variáveis preditivas selecionadas. 
Iremos definir como nível de significância 5%.

## Modelo de regressão inicial
```{r}
model <- lm(formula = Survived ~ Sex + Fare + Pclass, data = titanic_data)
tidy(model)
```

## Análise ANOVA
```{r}
anova(model)
```

## Removendo a variável 'fare'
Como a variável 'fare' possui um valor-p (~0,418) maior que o nível de significância (0,05) fixado, tiraremos ela do modelo e prosseguimos.

## Novo modelo de regressão
```{r}
model <- lm(formula = Survived ~ Sex + Pclass, data = titanic_data)
tidy(model)
```

## Calculando o R-quadrado
```{r, echo=FALSE}
rQuadrado <- summary(model)$r.squared
rQuadrado
```

## Análise dos resíduos
Adicione a análise dos resíduos

## Conclusão
Adicione aqui uma conclusão

